<div class="container-fluid">
    <div class="row">
      <div class="col-lg-12">
        <div class="card shadow-sm">
          <div class="card-header">
            <h4 class="card-title mb-0">Customer Report</h4>
          </div>
          <div class="card-body">
            <!-- Form for Customer NIC -->
            <form [formGroup]="form" (ngSubmit)="onSubmit()">
              <table class="table">
                <tbody>
                  <tr>
                    <td><label for="customerNIC">Customer NIC:</label></td>
                    <td>
                      <input
                        id="customerNIC"
                        formControlName="customerNIC"
                        class="form-control"
                        placeholder="Enter customer NIC"
                      />
                    </td>
                    <td><button type="submit" class="btn btn-primary">Get Report</button></td>
                  </tr>
                </tbody>
              </table>
            </form>
  
            <!-- Customer Details -->
            <div *ngIf="report" class="mt-4">
              <h2>Customer Details</h2>
              <table class="table table-bordered">
                <tbody>
                  <tr>
                    <td><strong>Name:</strong></td>
                    <td>{{ report.customerName }}</td>
                  </tr>
                  <tr>
                    <td><strong>NIC:</strong></td>
                    <td>{{ report.customerNIC }}</td>
                  </tr>
                  <tr>
                    <td><strong>Total Loaned Amount:</strong></td>
                    <td>{{ report.totalLoanedAmount | currency }}</td>
                  </tr>
                  <tr>
                    <td><strong>Total Amount Paid:</strong></td>
                    <td>{{ report.totalAmountPaid | currency }}</td>
                  </tr>
                  <tr>
                    <td><strong>Total Outstanding Amount:</strong></td>
                    <td>{{ report.totalOutstandingAmount | currency }}</td>
                  </tr>
                </tbody>
              </table>
  
              <!-- Loans and Installments -->
              <h3 class="mt-4">Loans</h3>
              <div *ngFor="let loan of report.loans; let i = index">
                <table class="table table-bordered mb-4">
                  <thead class="thead-light">
                    <tr (click)="toggleInstallments(i)">
                      <th>Loan ID</th>
                      <th>Transaction ID</th>
                      <th>Start Date</th>
                      <th>End Date</th>
                      <th>Expand</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>{{ loan.loanId }}</td>
                      <td>{{ loan.transactionId }}</td>
                      <td>{{ loan.startDate | date }}</td>
                      <td>{{ loan.endDate | date }}</td>
                      <td>
                        <button class="btn btn-link" (click)="toggleInstallments(i)">
                          {{ showInstallments[i] ? 'Hide Installments' : 'Show Installments' }}
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
  
                <!-- Installments (Visible Only When Toggled) -->
                <div *ngIf="showInstallments[i]">
                  <h4>Installments</h4>
                  <table class="table table-bordered">
                    <thead class="thead-light">
                      <tr>
                        <th>Amount Paid</th>
                        <th>Date Paid</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let installment of loan.installments">
                        <td>{{ installment.amountPaid | currency }}</td>
                        <td>{{ installment.datePaid | date }}</td>
                      </tr>
                      <tr *ngIf="loan.installments.length === 0">
                        <td colspan="2" class="text-center">No installments yet.</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div><!-- end card body -->
        </div><!-- end card -->
      </div><!-- end col -->
    </div><!-- end row -->
  </div><!-- end container-fluid -->
  