<!-- Unified Transaction History -->
<div class="container-fluid px-4 py-3">
  <app-page-header 
    title="Transaction History & Reports" 
    subtitle="Comprehensive transaction management and analytics">
  </app-page-header>

  <!-- Loading State -->
  <div *ngIf="loading" class="d-flex justify-content-center align-items-center loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading">
    <!-- Summary Cards -->
    <div class="row mb-4">
      <div class="col-lg-3 col-md-6 mb-3">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h6 class="card-title text-muted">Total Transactions</h6>
            <h4 class="text-primary mb-0">{{ transactionSummary?.totalTransactions | number }}</h4>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-3">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h6 class="card-title text-muted">Total Amount</h6>
            <h4 class="text-success mb-0">{{ formatCurrency(transactionSummary?.totalAmount || 0) }}</h4>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-3">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h6 class="card-title text-muted">Average Amount</h6>
            <h4 class="text-info mb-0">{{ formatCurrency(transactionSummary?.averageAmount || 0) }}</h4>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-3">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h6 class="card-title text-muted">Date Range</h6>
            <h4 class="text-secondary mb-0">{{ transactionSummary?.dateRange || 'N/A' }}</h4>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h6 class="card-title mb-3">Filters & Search</h6>
            
            <!-- Date Range Selection -->
            <div class="row mb-3">
              <div class="col-md-3">
                <label class="form-label text-muted small">Date Range</label>
                <app-modern-date-range-picker
                  (dateRangeSelected)="onDateRangeSelected($event)"
                  placeholder="Select date range"
                  class="w-100">
                </app-modern-date-range-picker>
              </div>
              <div class="col-md-6">
                <label class="form-label text-muted small">Search</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-search"></i></span>
                  <input 
                    type="text" 
                    class="form-control" 
                    placeholder="Search by customer name, NIC, or invoice number..."
                    [formControl]="searchControl">
                </div>
              </div>
              <div class="col-md-3">
                <label class="form-label text-muted small">Actions</label>
                <div class="d-flex gap-2">
                  <button class="btn btn-outline-primary" (click)="openAdvancedFilters()">
                    <i class="bi bi-funnel"></i> Filters
                  </button>
                  <button class="btn btn-outline-success" (click)="exportData()">
                    <i class="bi bi-download"></i> Export
                  </button>
                </div>
              </div>
            </div>

            <!-- Quick Filters -->
            <div class="row mb-3">
              <div class="col-12">
                <h6 class="text-muted small mb-2">Transaction Types:</h6>
                <div class="btn-group flex-wrap" role="group">
                  <button 
                    *ngFor="let type of transactionTypes" 
                    type="button" 
                    class="btn btn-outline-secondary btn-sm"
                    [class.active]="selectedTypes.includes(type.value)"
                    (click)="toggleType(type.value)">
                    <span class="badge me-1" [class]="'bg-' + getTransactionTypeColor(type.value)"></span>
                    {{ type.label }}
                  </button>
                </div>
              </div>
            </div>

            <!-- Advanced Filters Panel -->
            <div *ngIf="showAdvancedFilters" class="row">
              <div class="col-12">
                <div class="card bg-light border-0">
                  <div class="card-body">
                    <h6 class="card-title">Advanced Filters</h6>
                    <form [formGroup]="filtersForm">
                      <div class="row">
                        <div class="col-md-4">
                          <label class="form-label">Customer NIC</label>
                          <input type="text" class="form-control" formControlName="customerNIC" placeholder="Enter customer NIC">
                        </div>
                        <div class="col-md-4">
                          <label class="form-label">Invoice Number</label>
                          <input type="text" class="form-control" formControlName="invoiceNo" placeholder="Enter invoice number">
                        </div>
                        <div class="col-md-4">
                          <label class="form-label">Loan Status</label>
                          <select class="form-select" formControlName="loanStatus" title="Filter by loan status">
                            <option value="all">All Loans</option>
                            <option value="active">Active Loans</option>
                            <option value="settled">Settled Loans</option>
                          </select>
                        </div>
                      </div>
                      <div class="row mt-3">
                        <div class="col-md-6">
                          <label class="form-label">Amount Range</label>
                          <div class="row">
                            <div class="col-6">
                              <input type="number" class="form-control" placeholder="Min Amount" formControlName="minAmount">
                            </div>
                            <div class="col-6">
                              <input type="number" class="form-control" placeholder="Max Amount" formControlName="maxAmount">
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6 d-flex align-items-end">
                          <button type="button" class="btn btn-secondary me-2" (click)="clearFilters()">
                            <i class="bi bi-x-circle"></i> Clear
                          </button>
                          <button type="button" class="btn btn-primary" (click)="applyAdvancedFiltersFromForm()">
                            <i class="bi bi-check-circle"></i> Apply
                          </button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

            <!-- Data Table -->
    <div class="row">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <app-data-table
              [data]="filteredTransactions"
              [columns]="tableColumns"
              [loading]="loading"
              [pagination]="true"
              [pageSize]="25"
              [selectable]="true"
              [actions]="tableActions"
              (action)="onTableAction($event)"
              (selectionChange)="onTableSelectionChange($event)">
            </app-data-table>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredTransactions.length === 0" class="row mt-4">
      <div class="col-12">
        <div class="text-center py-5">
          <i class="bi bi-inbox display-1 text-muted"></i>
          <h4 class="text-muted">No transactions found</h4>
          <p class="text-muted">Try adjusting your filters or search criteria.</p>
          <button class="btn btn-primary" (click)="clearFilters()">
            Clear Filters
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
